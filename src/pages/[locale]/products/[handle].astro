---
import BaseLayout from '@/layouts/BaseLayout.astro'
import { retrieveProduct, type MedusaProduct } from '@/lib/api'
import { getI18n, getLocaleFromParams } from '@/i18n/utils'
const locale = getLocaleFromParams(Astro.params)
const { t } = getI18n(locale)
const { handle } = Astro.params
const product = await retrieveProduct(handle!) as MedusaProduct
const price = product.variants?.[0]?.prices?.[0]
const amount = price ? (price.amount / 100).toFixed(2) + ' ' + price.currency_code?.toUpperCase() : ''
---

<BaseLayout title={`${product.title} | ${t('common','siteName')}`} description={product.description}>
  <div class="grid md:grid-cols-2 gap-8">
    <img src={product.thumbnail || '/placeholder.png'} alt={product.title} class="w-full rounded-lg" />
    <div>
      <h1 class="text-2xl font-semibold">{product.title}</h1>
      <p class="text-gray-600 mt-2">{product.description}</p>
      <p class="mt-4 text-xl font-bold">{amount}</p>
      <div class="mt-6">
        <AddToCart client:load id={product.id} title={product.title} price={price?.amount || 0} currency={price?.currency_code || 'jpy'} image={product.thumbnail} label={t('products','addToCart')} />
      </div>
    </div>
  </div>

  <script>
    import AddToCart from '@/components/shared/AddToCart'
  </script>
</BaseLayout>
